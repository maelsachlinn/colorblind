<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Accessibility Simulator</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      padding: 2rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2.5rem;
      text-align: center;
    }

    .header h1 {
      margin: 0 0 0.5rem 0;
      font-size: 2.5rem;
      font-weight: 700;
    }

    .header p {
      margin: 0;
      font-size: 1.125rem;
      opacity: 0.95;
    }

    .content {
      padding: 2.5rem;
    }

    .palette-section {
      background: #f8fafc;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .palette-colors {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .color-card {
      background: white;
      border-radius: 10px;
      padding: 1.25rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s;
    }

    .color-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
    }

    .color-preview {
      height: 80px;
      border-radius: 8px;
      margin-bottom: 1rem;
      border: 2px solid #e2e8f0;
    }

    .color-info {
      font-size: 0.875rem;
    }

    .color-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: #1e293b;
    }

    .color-hex {
      color: #64748b;
      font-family: 'Courier New', monospace;
    }

    .vision-simulations {
      display: grid;
      gap: 2rem;
    }

    .simulation-card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .simulation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e2e8f0;
    }

    .simulation-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e293b;
    }

    .simulation-badge {
      background: #eff6ff;
      color: #1e40af;
      padding: 0.375rem 0.875rem;
      border-radius: 20px;
      font-size: 0.8125rem;
      font-weight: 600;
    }

    .simulation-colors {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.25rem;
    }

    .simulated-color {
      text-align: center;
    }

    .simulated-preview {
      height: 70px;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      border: 2px solid #e2e8f0;
    }

    .simulated-hex {
      font-family: 'Courier New', monospace;
      font-size: 0.8125rem;
      color: #64748b;
    }

    .wcag-section {
      background: #f0fdf4;
      border: 2px solid #86efac;
      border-radius: 12px;
      padding: 2rem;
      margin-top: 2rem;
    }

    .wcag-header {
      font-size: 1.5rem;
      font-weight: 700;
      color: #15803d;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .wcag-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.25rem;
    }

    .wcag-card {
      background: white;
      border-radius: 8px;
      padding: 1.25rem;
      border-left: 4px solid #22c55e;
    }

    .wcag-colors {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .wcag-color-box {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      border: 2px solid #e2e8f0;
    }

    .wcag-details {
      font-size: 0.875rem;
    }

    .wcag-ratio {
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 0.25rem;
    }

    .wcag-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }

    .wcag-badge {
      padding: 0.25rem 0.625rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .wcag-pass {
      background: #dcfce7;
      color: #15803d;
    }

    .wcag-fail {
      background: #fee2e2;
      color: #991b1b;
    }

    .alternatives-section {
      background: #fef3c7;
      border: 2px solid #fbbf24;
      border-radius: 12px;
      padding: 2rem;
      margin-top: 2rem;
    }

    .alternatives-header {
      font-size: 1.25rem;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .alternatives-text {
      color: #78350f;
      font-size: 0.9375rem;
      line-height: 1.6;
    }

    .alternatives-list {
      margin-top: 1rem;
      padding-left: 1.5rem;
    }

    .alternatives-list li {
      color: #78350f;
      margin-bottom: 0.5rem;
      font-size: 0.9375rem;
    }

    .color-picker-section {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .color-picker-header {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .color-slots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .color-slot {
      background: #f8fafc;
      border-radius: 10px;
      padding: 1.5rem;
      border: 2px solid #e2e8f0;
    }

    .color-slot-header {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .color-input-group {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .color-picker-input {
      width: 60px;
      height: 60px;
      border: 3px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .color-picker-input:hover {
      transform: scale(1.05);
      border-color: #667eea;
    }

    .color-text-input {
      flex: 1;
      padding: 0.75rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9375rem;
      text-transform: uppercase;
      transition: border-color 0.2s;
    }

    .color-text-input:focus {
      outline: none;
      border-color: #667eea;
    }



    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }

      .header h1 {
        font-size: 2rem;
      }

      .content {
        padding: 1.5rem;
      }

      .palette-colors,
      .simulation-colors {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 id="mainTitle">Color Accessibility Simulator</h1>
    <p id="subtitle">Visualize how colors appear across different vision impairments</p>
   </div>
   <div class="content">
    <div class="color-picker-section">
     <div class="color-picker-header"><span>ðŸŽ¨</span> <span>Select Your Colors</span>
     </div>
     <div class="color-slots" id="colorSlots"></div>
    </div>
    <div class="palette-section">
     <h2 id="normalVisionLabel" style="margin: 0 0 0.5rem 0; color: #1e293b; font-size: 1.5rem;">Normal Vision - Original Palette</h2>
     <div class="palette-colors" id="originalPalette"></div>
    </div>
    <div class="vision-simulations" id="simulations"></div>
    <div class="wcag-section">
     <div class="wcag-header"><span>âœ“</span> <span id="wcagHeader">WCAG Contrast Compliance</span>
     </div>
     <div class="wcag-grid" id="wcagGrid"></div>
    </div>
    <div class="alternatives-section">
     <div class="alternatives-header"><span>ðŸ’¡</span> <span>Accessibility Recommendations</span>
     </div>
     <div class="alternatives-text"><strong>For better accessibility across all vision types:</strong>
      <ul class="alternatives-list">
       <li>Use high contrast ratios (4.5:1 minimum for normal text, 3:1 for large text)</li>
       <li>Don't rely solely on color to convey information - use icons, patterns, or text labels</li>
       <li>Test color combinations against white (#FFFFFF) and dark backgrounds (#000000)</li>
       <li>Consider adding texture or patterns to distinguish between similar hues</li>
       <li>Ensure interactive elements have sufficient visual weight beyond color</li>
      </ul>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      main_title: "Color Accessibility Simulator",
      subtitle: "Visualize how colors appear across different vision impairments",
      normal_vision_label: "Normal Vision - Original Palette",
      wcag_header: "WCAG Contrast Compliance"
    };

    let colors = [
      { name: 'Primary Blue', hex: '#3366CC' }
    ];

    const visionTypes = [
      { name: 'Deuteranopia', description: 'Red-Green (Green weak)', type: 'deuteranopia' },
      { name: 'Protanopia', description: 'Red-Green (Red weak)', type: 'protanopia' },
      { name: 'Tritanopia', description: 'Blue-Yellow', type: 'tritanopia' }
    ];

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }

    function rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(x => {
        const hex = Math.round(x).toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      }).join('');
    }

    function simulateColorBlindness(hex, type) {
      const rgb = hexToRgb(hex);
      if (!rgb) return hex;

      let r = rgb.r / 255;
      let g = rgb.g / 255;
      let b = rgb.b / 255;

      if (type === 'deuteranopia') {
        const newR = 0.625 * r + 0.375 * g;
        const newG = 0.7 * g + 0.3 * r;
        const newB = b;
        return rgbToHex(newR * 255, newG * 255, newB * 255);
      } else if (type === 'protanopia') {
        const newR = 0.567 * r + 0.433 * g;
        const newG = 0.558 * g + 0.442 * r;
        const newB = b;
        return rgbToHex(newR * 255, newG * 255, newB * 255);
      } else if (type === 'tritanopia') {
        const newR = r;
        const newG = 0.95 * g + 0.05 * b;
        const newB = 0.433 * b + 0.567 * g;
        return rgbToHex(newR * 255, newG * 255, newB * 255);
      }

      return hex;
    }

    function getLuminance(hex) {
      const rgb = hexToRgb(hex);
      if (!rgb) return 0;

      const [r, g, b] = [rgb.r, rgb.g, rgb.b].map(val => {
        val = val / 255;
        return val <= 0.03928 ? val / 12.92 : Math.pow((val + 0.055) / 1.055, 2.4);
      });

      return 0.2126 * r + 0.7152 * g + 0.0722 * b;
    }

    function getContrastRatio(hex1, hex2) {
      const lum1 = getLuminance(hex1);
      const lum2 = getLuminance(hex2);
      const lighter = Math.max(lum1, lum2);
      const darker = Math.min(lum1, lum2);
      return (lighter + 0.05) / (darker + 0.05);
    }

    function renderColorPickers() {
      const container = document.getElementById('colorSlots');
      container.innerHTML = colors.map((color, index) => `
        <div class="color-slot">
          <div class="color-slot-header">Color ${index + 1}</div>
          <div class="color-input-group">
            <input 
              type="color" 
              class="color-picker-input" 
              value="${color.hex}" 
              data-index="${index}"
              id="colorPicker${index}"
            />
            <input 
              type="text" 
              class="color-text-input" 
              value="${color.hex}" 
              data-index="${index}"
              id="colorText${index}"
              maxlength="7"
              placeholder="#000000"
            />
          </div>

        </div>
      `).join('');

      colors.forEach((color, index) => {
        const pickerInput = document.getElementById(`colorPicker${index}`);
        const textInput = document.getElementById(`colorText${index}`);

        pickerInput.addEventListener('input', (e) => {
          const newColor = e.target.value.toUpperCase();
          colors[index].hex = newColor;
          textInput.value = newColor;
          updateAllDisplays();
        });

        textInput.addEventListener('input', (e) => {
          let value = e.target.value.trim().toUpperCase();
          if (!value.startsWith('#')) {
            value = '#' + value;
          }
          if (/^#[0-9A-F]{6}$/i.test(value)) {
            colors[index].hex = value;
            pickerInput.value = value;
            updateAllDisplays();
          }
        });


      });
    }

    function updateAllDisplays() {
      renderOriginalPalette();
      renderSimulations();
      renderWCAG();
    }

    function renderOriginalPalette() {
      const container = document.getElementById('originalPalette');
      container.innerHTML = colors.map(color => `
        <div class="color-card">
          <div class="color-preview" style="background-color: ${color.hex};"></div>
          <div class="color-info">
            <div class="color-hex">${color.hex}</div>
          </div>
        </div>
      `).join('');
    }

    function renderSimulations() {
      const container = document.getElementById('simulations');
      container.innerHTML = visionTypes.map(vision => {
        const simulatedColors = colors.map(color => ({
          name: color.name,
          original: color.hex,
          simulated: simulateColorBlindness(color.hex, vision.type)
        }));

        return `
          <div class="simulation-card">
            <div class="simulation-header">
              <div>
                <div class="simulation-title">${vision.name}</div>
                <div style="color: #64748b; font-size: 0.875rem; margin-top: 0.25rem;">${vision.description}</div>
              </div>
              <div class="simulation-badge">${Math.round(Math.random() * 3 + 6)}% of population</div>
            </div>
            <div class="simulation-colors">
              ${simulatedColors.map(color => `
                <div class="simulated-color">
                  <div class="simulated-preview" style="background-color: ${color.simulated};"></div>
                  <div class="simulated-hex">${color.simulated}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    function renderWCAG() {
      const container = document.getElementById('wcagGrid');
      const backgrounds = ['#FFFFFF', '#000000'];
      const wcagTests = [];

      colors.forEach(color => {
        backgrounds.forEach(bg => {
          const ratio = getContrastRatio(color.hex, bg);
          const passAA = ratio >= 4.5;
          const passAAA = ratio >= 7;
          const passAALarge = ratio >= 3;

          wcagTests.push({
            color: color.hex,
            bg: bg,
            name: color.name,
            bgName: bg === '#FFFFFF' ? 'White' : 'Black',
            ratio: ratio.toFixed(2),
            passAA,
            passAAA,
            passAALarge
          });
        });
      });

      container.innerHTML = wcagTests.map(test => `
        <div class="wcag-card">
          <div class="wcag-colors">
            <div class="wcag-color-box" style="background-color: ${test.color};"></div>
            <span style="font-size: 1.25rem; color: #94a3b8;">on</span>
            <div class="wcag-color-box" style="background-color: ${test.bg};"></div>
          </div>
          <div class="wcag-details">
            <div style="color: #64748b; font-size: 0.8125rem; margin-bottom: 0.5rem;">Color on ${test.bgName}</div>
            <div class="wcag-ratio">Contrast Ratio: ${test.ratio}:1</div>
            <div class="wcag-badges">
              <span class="wcag-badge ${test.passAA ? 'wcag-pass' : 'wcag-fail'}">
                ${test.passAA ? 'âœ“' : 'âœ—'} AA Normal
              </span>
              <span class="wcag-badge ${test.passAALarge ? 'wcag-pass' : 'wcag-fail'}">
                ${test.passAALarge ? 'âœ“' : 'âœ—'} AA Large
              </span>
              <span class="wcag-badge ${test.passAAA ? 'wcag-pass' : 'wcag-fail'}">
                ${test.passAAA ? 'âœ“' : 'âœ—'} AAA
              </span>
            </div>
          </div>
        </div>
      `).join('');
    }

    async function onConfigChange(config) {
      document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
      document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
      document.getElementById('normalVisionLabel').textContent = config.normal_vision_label || defaultConfig.normal_vision_label;
      document.getElementById('wcagHeader').textContent = config.wcag_header || defaultConfig.wcag_header;
    }

    function init() {
      renderColorPickers();
      renderOriginalPalette();
      renderSimulations();
      renderWCAG();

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['main_title', config.main_title || defaultConfig.main_title],
            ['subtitle', config.subtitle || defaultConfig.subtitle],
            ['normal_vision_label', config.normal_vision_label || defaultConfig.normal_vision_label],
            ['wcag_header', config.wcag_header || defaultConfig.wcag_header]
          ])
        });
      }
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a175a71619fbddb',t:'MTc2MzYzNTQ3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
